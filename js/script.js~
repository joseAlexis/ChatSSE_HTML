/*----------------Conexion al servidor----------------*/
if(typeof(EventSource)!=="undefined")
{
	var source=new EventSource("chat.php");
  	
  	source.onmessage=function(event){
  		var contenido = event.data.split("/**fin**/");
  		document.getElementById("txtChat").innerHTML = "";
  		
  		for (var i = 0; i <= contenido.length - 1; i++) {		  					
			document.getElementById("txtChat").innerHTML += contenido[i] + "\n";
		}
   };
}
else 
{
	document.getElementById("txtChat").innerHTML="Lo sentimos, su navegador no soporta el SSE (Server Sent Events)";
}

/*----------------Scroll abajo----------------*/
window.setInterval(function() {
  var elem = document.getElementById('txtChat');
  elem.scrollTop = elem.scrollHeight;
}, 1000);

/*----------------Funcion que valida que no hallan palabras vulgares----------------*/
function validarPalabras() {	
	
	/*obtenerPosicion();*/
	
	var sentencia = document.getElementById("txtTexto").value;

	var resultado = new Array();	
	resultado = sentencia.split(" ");
	
	var palabrasReservadas = new Array("picha", "hijueputa", "mierda", "malparido", "malparida","playo", "loca", "cagon", "gay", "puto", "puta", "putas");
	
	var nuevaSentencia = "";
	
	for (var i = 0; i < resultado.length; i++) 
	{
		for (var j = 0; j < palabrasReservadas.length; j++) 
		{
				if(resultado[i] == palabrasReservadas[j])
				{
					resultado[i] = "*censurado*";
				}
		}
		nuevaSentencia += resultado[i] + " ";
	}
	
	ubicacion = document.getElementById("demo").value;
	document.getElementById('frmChat').action = "index.php?comentario=" + nuevaSentencia +"&ubicacion="+ ubicacion;
}



function getLocation()
{
	var x=document.getElementById("demo");
	
  if (navigator.geolocation)
    {
    navigator.geolocation.getCurrentPosition(showPosition);
    }
  else{x.value="Geolocation is not supported by this browser.";}
  }
function showPosition(position)
  {
  	var x=document.getElementById("demo");
  x.value= + position.coords.latitude + 
  " " + position.coords.longitude;	
  }
